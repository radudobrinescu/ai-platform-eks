# Langfuse Helm Values — LLM Observability & Tracing
# Chart: langfuse/langfuse
# Repository: https://langfuse.github.io/langfuse-k8s
#
# Simplified setup: bundled PostgreSQL, ClickHouse, Redis (no external RDS).
# Secrets are created by Terraform (kubernetes_secret "langfuse_secrets") and
# referenced here via secretKeyRef — no secrets stored in git.

langfuse:
  salt:
    secretKeyRef:
      name: langfuse-secrets
      key: salt

  nextauth:
    url: "http://langfuse-web.ai-platform.svc.cluster.local:3000"
    secret:
      secretKeyRef:
        name: langfuse-secrets
        key: nextauth-secret

  encryptionKey:
    secretKeyRef:
      name: langfuse-secrets
      key: encryption-key

  additionalEnv:
    - name: LANGFUSE_S3_EVENT_UPLOAD_ENABLED
      value: "false"
    - name: LANGFUSE_S3_BATCH_EXPORT_ENABLED
      value: "false"
    - name: LANGFUSE_S3_MEDIA_UPLOAD_ENABLED
      value: "false"

  service:
    type: ClusterIP
    port: 3000

  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: "2"
      memory: 2Gi

  ingress:
    enabled: false

# Bundled PostgreSQL (for dev/test — use ACK-managed RDS for production)
postgresql:
  deploy: true
  auth:
    existingSecret: langfuse-secrets
    secretKeys:
      adminPasswordKey: password
  primary:
    persistence:
      enabled: true
      size: 20Gi
      storageClass: gp3

# ClickHouse for analytics/event ingestion
clickhouse:
  deploy: true
  replicaCount: 1
  auth:
    existingSecret: langfuse-secrets
    existingSecretKey: clickhouse-password
  persistence:
    enabled: true
    size: 50Gi
    storageClass: gp3
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: "2"
      memory: 4Gi

# Redis for caching and queue management
redis:
  deploy: true
  auth:
    existingSecret: langfuse-secrets
    existingSecretPasswordKey: redis-password
  primary:
    persistence:
      enabled: true
      size: 8Gi
      storageClass: gp3
